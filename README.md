# MAX Bot Mini App

Чат-бот для мессенджера MAX с мини-приложением для трекинга активности, целей и достижений.

## Запуск через Docker

### Требования

- Docker и Docker Compose
- Токен бота из Master Bot

### Быстрый старт

1. Создайте тоннель на cloudpub, используя данные из презентации.

Перенаправьте трафик с http://localhost:3000/ на https://sila-duha.cloudpub.ru/



2. Заполните `.env`, используя данные из презентации:
```env
BOT_TOKEN=
MINIAPP_URL=
MINIAPP_API_BASE=
PORT=3000
```

3. Соберите и запустите:
```bash
docker compose build
docker compose up -d
```

4. Проверьте логи:
```bash
docker compose logs -f max-bot
```

Приложение будет доступно на `http://localhost:3000` (или по https://sila-duha.cloudpub.ru/).

### Управление контейнером

```bash
# Остановка
docker compose down

# Перезапуск
docker compose restart

# Просмотр логов
docker compose logs -f max-bot
```


## Функционал мини-приложения

### Главная страница (Home)
- Отображение текущей серии дней (стрека)
- Установка и отслеживание дневных целей на сегодня и завтра
- Отображение продуктивных минут за сегодня
- Кастомизация: выбор фона и шляпы для главной страницы
- Покупка элементов кастомизации за валюту

### Статистика (Stats)
- Просмотр статистики активности за выбранный период
- Круговые диаграммы распределения времени по типам активности
- Просмотр статистики друзей (если включен обмен)
- Выбор пользователя для просмотра статистики
- Выбор периода (дата начала и конца)

### Время (Time)
- Трекинг времени активности в течение дня
- Добавление меток времени с указанием типа активности
- Визуализация интервалов активности на временной шкале
- Редактирование и удаление меток
- Просмотр активности за предыдущие дни через календарь
- Типы активности: сон, продуктивная работа, отдых, прокрастинация

### Люди (People)
- Список друзей
- Входящие и исходящие заявки в друзья
- Уведомления о событиях (заявки, принятие, отклонение)
- Просмотр профиля друга
- Настройка обмена статистикой с друзьями
- Отвязка аккаунта

### Предметы (Subjects)
- Список достижений и их статус
- Отображение заработанной валюты
- Достижения:
  - Рабочий день: проработать 8 часов за день
  - Первый шаг: выполнить дневную цель
  - Планровщик: установить цель на завтра
  - Социальность: добавить друга
  - Фокус: завершить 30 минут работы
  - Здоровый сон: проспать 56 часов за неделю

## Авторизация

Приложение требует привязки аккаунта MAX:
1. При первом запуске генерируется код авторизации
2. Код копируется и отправляется боту в чат MAX
3. Бот подтверждает привязку аккаунта
4. После привязки можно использовать все функции приложения

## Синхронизация данных

Все данные (активность, цели, достижения, социальная информация) синхронизируются с сервером и сохраняются локально в `localStorage` как резервная копия. При отсутствии связи с сервером изменения сохраняются локально и синхронизируются при восстановлении соединения.

Данные пользователей сохраняются в директории `./data` на хосте (монтируется в Docker как volume).

## Структура проекта

```
bot-maxtg/
├── src/              # Серверный код (Express + MAX Bot)
├── miniapp/src/      # Клиентский код (React)
├── media/            # Медиафайлы (иконки, изображения)
├── data/             # Данные пользователей (создается автоматически)
├── Dockerfile        # Конфигурация Docker-образа
├── docker-compose.yml # Конфигурация Docker Compose
└── .env              # Переменные окружения (не попадает в Git)
```

